{% extends "base.html" %}
{% load static %}
{% load filters %}
{% load i18n %}

{% block body_class %}template-homepage{% endblock %}

{% block extra_js %}
    <script>
        $(document).ready(function () {
            var initialData = {{ initial_data | jsonify }};
            vm = new Test();
            ko.applyBindings(vm);
            {#            if (initialData.questions) {#}
            {#                var mapping = {#}
            {#                    'questions': {#}
            {#                        create: function (options) {#}
            {#                            var question_mapping = {#}
            {#                                'choices': {#}
            {#                                    create: function (options) {#}
            {#                                        var choice = ko.mapping.fromJS(options.data, {}, new Choice());#}
            {#                                        return choice;#}
            {#                                    }#}
            {#                                },#}
            {#                                'image': {#}
            {#                                    update: function (options) {#}
            {#                                        if (!options.data) {#}
            {#                                            return {#}
            {#                                                dataURL: ko.observable()#}
            {#                                            }#}
            {#                                        } else {#}
            {#                                            return {#}
            {#                                                dataURL: ko.observable(options.data)#}
            {#                                            }#}
            {#                                        }#}
            {#                                    }#}
            {#                                }#}
            {#                            };#}
            {##}
            {#                            var question = ko.mapping.fromJS(options.data, question_mapping, new Question());#}
            {##}
            {#                            return question;#}
            {#                        }#}
            {#                    }#}
            {#                };#}
            {#                ko.mapping.fromJS(initialData, mapping, vm);#}
            {#            }#}
        });
    </script>
    <script type="text/javascript" src="{% static 'public/plugins/knockout/dist/knockout.js' %}"></script>
    <script type="text/javascript" src="{% static 'public/plugins/knockout-mapping/knockout.mapping.js' %}"></script>
    <script type="text/javascript" src="{% static 'public/plugins/knockout-bindings/bindings.js' %}"></script>
    <script type="text/javascript"
            src="{% static 'public/plugins/knockout-file-bindings/knockout-file-bindings.js' %}"></script>

    <script type="text/javascript"
            src="{% static 'public/plugins/bootstrap-toggle/js/bootstrap-toggle.min.js' %}"></script>

    <script type="text/javascript" src="{% static 'public/plugins/blockUI/jquery.blockUI.js' %}"></script>
    <script type="text/javascript" src="{% static 'public/plugins/toastr/toastr.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'public/plugins/jsutil/App.js' %}"></script>
    <script type="text/javascript" src="{% static 'public/academy/js/test_form.js' %}"></script>
{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" type="text/css"
          href="{% static 'public/plugins/bootstrap-toggle/css/bootstrap-toggle.min.css' %}">
    <link rel="stylesheet" type="text/css"
          href="{% static 'public/plugins/toastr/toastr.min.css' %}">
    <link rel="stylesheet" type="text/css"
          href="{% static 'public/plugins/knockout-file-bindings/knockout-file-bindings.css' %}">
{% endblock %}

{% block content %}

    <form data-bind="submit: save" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="card bg-faded">
            <div class="card-block">
                {{ forms.test_create_form }}
            </div>
            {#            This div is for selected course chapters#}
            <div class="card-block">
                <!-- ko foreach: selected_course_chapter_questions -->


                <div id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="card">
                        <div class="card-header" role="tab"
                             data-bind="attr: { id: 'chq-title' + String($data.id) }">
                            <h5 class="mb-0">
                                <a data-toggle="collapse" data-parent="#accordion"
                                   aria-expanded="false"
                                   data-bind="attr: { 'href': '#' + 'chq-body' + String($data.id), 'aria-controls': 'chq-body' + String($data.id) }, text: $data.name">
                                </a>
                            </h5>
                        </div>

                        <div class="collapse" role="tabpanel"
                             data-bind="attr: { 'aria-labelledby': 'chq-title' + String($data.id), 'id': 'chq-body' + String($data.id) }">
                            <div class="card-block">
                                <!-- ko foreach: questions -->
                                <div class="card-block row bg-faded my-3">
                                    <div class="card-block col-8">
                                        Question: <p data-bind="text: $data.detail"></p>
                                    </div>
                                    <div class="card-block col-4">
                                        Type: <p data-bind="text: $data.type"></p>
                                    </div>
                                    <div data-bind="visible: $data.type == 'OBJECTIVE' ? true : false " class="col-12">
                                        <div class="col-12">
                                            Choices:
                                        </div>
                                        <!-- ko foreach: choices -->
                                        <div class="col-12">
                                            <p data-bind="text: $data.detail"></p>
                                        </div>
                                        <!-- /ko -->
                                    </div>
                                    <div class="col-12">
                                        <div class="float-right">
                                            Selected: <input type="checkbox"
                                                             data-bind="bsToggle: $data.is_selected, bsToggleData: {'on': 'Yes', 'off': 'No'}">
                                        </div>
                                        <div class="float-right mx-3" data-bind="visible: $data.is_selected()">
                                            Points: <input type="number" data-bind="value: $data.points">
                                        </div>

                                    </div>
                                </div>
                                <!-- /ko -->

                            </div>
                        </div>
                    </div>

                </div>
                <!-- /ko -->
            </div>

    </form>

{% endblock %}
